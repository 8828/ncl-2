NCARG		= ../../../..
#
#	$Id: yMakefile,v 1.14 1993-04-04 21:23:15 clyne Exp $
#

MYNAME1		= $(ROBJPATH)/libictrans.o
MYNAME2		= $(ROBJPATH)/libictrans_.o

#
# name of the spooler translator
#
SPOOL_TRANS	= ctrans

EQUALHACK	= =

CDEFINES	=

EXTENSION_OBJS	= ictrans_mem.o ictrans_wks.o fort_ictrans.o

EXTENSION_SRCS	= ictrans_mem.c ictrans_wks.c 

GENERIC_OBJS	= lex.yy.o commands.o cmd_tab.o get_cmd.o \
		glob.o spooler.o ictrans.o lex_stuff.o input.o

GENERIC_SRCS	= commands.c cmd_tab.c get_cmd.c \
		glob.c spooler.c ictrans.c input.c

OBJS	= $(GENERIC_OBJS) $(EXTENSION_OBJS)
SRCS	= $(GENERIC_SRCS) $(EXTENSION_SRCS)

all::   $(MYNAME1)

$(MYNAME1):	$(OBJS)
	$(LD_REL) -r -o $(MYNAME1) $(OBJS)

all::   $(MYNAME2)

$(MYNAME2):	$(GENERIC_OBJS)
	$(LD_REL) -r -o $(MYNAME2) $(GENERIC_OBJS)

install::

MakefileTarget
CleanTarget


# Files that contain C functions that are called by Fortran

ictrans_wks.c: ictrans_wks.c.sed Makefile
        @$(CALLCONV) $(SYSTEM_INCLUDE) ictrans_wks.c \
        initic ictarg opnwks clswks wrtwks rdwks begwks lstwks

# Files that need to know installation directories

commands.o:	commands.c Makefile
	$(CC) $(CFLAGS) \
	-DSPOOL_TRANS$(EQUALHACK)'"$(SPOOL_TRANS)"' \
	-DBINDIR$(EQUALHACK)'"$(BINDIR)"' \
	-DTMPDIR$(EQUALHACK)'"$(TMPDIR)"' \
	-c $*.c

spooler.o:	spooler.c Makefile
	$(CC) $(CFLAGS) \
	-DLIBDIR$(EQUALHACK)'"$(LIBDIR)"' \
	-DNCARGDIR$(EQUALHACK)'"$(NCARGDIR)"' \
	-c $*.c

#
# Brain-damaged SGI C compiler won't compile its own lex output in
# ANSI mode.
#
#ifdef	sgi
lex.yy.o:	lex.yy.c
	$(CC) -c $(CDEBUG) $(COPT) $*.c
#endif

lex.yy.c: lex.l Makefile
	@echo '1a\' > sedscript
	@echo '#include "input.h"' >>  sedscript
	@echo 's/yylex/my_yylex/g' >>  sedscript
	@echo 's/getc/my_getc/g' >>  sedscript
	@echo 's/static void __yy__unused() { main(); }//g' >>  sedscript
	lex lex.l
	@$(MV) lex.yy.c lex.yy.c.sed
	@sed -f sedscript < lex.yy.c.sed > lex.yy.c
	@$(RM) lex.yy.c.sed sedscript

clean::
	@-$(RM) lex.yy.c.sed sedscript ictrans_wks.c

lint: $(SRCS)
	lint $(CDEFINES) $(LINTLIBS) $(CINC) $(SRCS) \ 
		-DSPOOL_TRANS$(EQUALHACK)'"$(SPOOL_TRANS)"' 1> lint.out 2>&1


