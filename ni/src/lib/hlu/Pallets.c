/*
 *      $Id: Pallets.c,v 1.1 1995-04-22 01:01:57 boote Exp $
 */
/************************************************************************
*									*
*			     Copyright (C)  1995			*
*	     University Corporation for Atmospheric Research		*
*			     All Rights Reserved			*
*									*
************************************************************************/
/*
 *	File:		Pallets.c
 *
 *	Author:		Jeff W. Boote
 *			National Center for Atmospheric Research
 *			PO 3000, Boulder, Colorado
 *
 *	Date:		Tue Apr 18 18:34:21 MDT 1995
 *
 *	Description:	
 */
#include <ncarg/hlu/hluP.h>
#include <ncarg/hlu/Workstation.h>
#include <ncarg/hlu/PalletsP.h>
#include <ncarg/hlu/ConvertersP.h>

static NhlColor def[] = {
	{-1.0,0.0,0.0},	/* white/black */
	{-1.0,0.0,0.0},	/* white/black */
	{0.6667,1.0000,1.0000},
	{0.3333,1.0000,1.0000},
	{0.0000,1.0000,1.0000},
	{1.0000,0.8333,1.0000},
	{0.6667,0.8333,1.0000},
	{0.3333,0.8333,1.0000},
	{0.0000,0.8333,1.0000},
	{1.0000,0.6667,1.0000},
	{0.6667,0.6667,1.0000},
	{0.3333,0.6667,1.0000},
	{0.0000,0.6667,1.0000},
	{1.0000,0.5000,1.0000},
	{0.6667,0.5000,1.0000},
	{0.3333,0.5000,1.0000},
	{0.0000,0.5000,1.0000},
	{1.0000,0.3333,1.0000},
	{0.6667,0.3333,1.0000},
	{0.3333,0.3333,1.0000},
	{0.0000,0.3333,1.0000},
	{1.0000,0.1667,1.0000},
	{0.6667,0.1667,1.0000},
	{0.3333,0.1667,1.0000},
	{0.0000,0.1667,1.0000},
	{1.0000,0.0000,1.0000},
	{0.6667,0.0000,1.0000},
	{0.3333,0.0000,1.0000},
	{0.0000,0.0000,1.0000},
	{1.0000,1.0000,0.6667},
	{0.6667,1.0000,0.6667},
	{0.3333,1.0000,0.6667},
	{0.0000,1.0000,0.6667},
	{1.0000,0.8333,0.6667},
	{0.6667,0.8333,0.6667},
	{0.3333,0.8333,0.6667},
	{0.0000,0.8333,0.6667},
	{1.0000,0.6667,0.6667},
	{0.6667,0.6667,0.6667},
	{0.3333,0.6667,0.6667},
	{0.0000,0.6667,0.6667},
	{1.0000,0.5000,0.6667},
	{0.6667,0.5000,0.6667},
	{0.3333,0.5000,0.6667},
	{0.0000,0.5000,0.6667},
	{1.0000,0.3333,0.6667},
	{0.6667,0.3333,0.6667},
	{0.3333,0.3333,0.6667},
	{0.0000,0.3333,0.6667},
	{1.0000,0.1667,0.6667},
	{0.6667,0.1667,0.6667},
	{0.3333,0.1667,0.6667},
	{0.0000,0.1667,0.6667},
	{1.0000,0.0000,0.6667},
	{0.6667,0.0000,0.6667},
	{0.3333,0.0000,0.6667},
	{0.0000,0.0000,0.6667},
	{1.0000,1.0000,0.3333},
	{0.6667,1.0000,0.3333},
	{0.3333,1.0000,0.3333},
	{0.0000,1.0000,0.3333},
	{1.0000,0.8333,0.3333},
	{0.6667,0.8333,0.3333},
	{0.3333,0.8333,0.3333},
	{0.0000,0.8333,0.3333},
	{1.0000,0.6667,0.3333},
	{0.6667,0.6667,0.3333},
	{0.3333,0.6667,0.3333},
	{0.0000,0.6667,0.3333},
	{1.0000,0.5000,0.3333},
	{0.6667,0.5000,0.3333},
	{0.3333,0.5000,0.3333},
	{0.0000,0.5000,0.3333},
	{1.0000,0.3333,0.3333},
	{0.6667,0.3333,0.3333},
	{0.3333,0.3333,0.3333},
	{0.0000,0.3333,0.3333},
	{1.0000,0.1667,0.3333},
	{0.6667,0.1667,0.3333},
	{0.3333,0.1667,0.3333},
	{0.0000,0.1667,0.3333},
	{1.0000,0.0000,0.3333},
	{0.6667,0.0000,0.3333},
	{0.3333,0.0000,0.3333},
	{0.0000,0.0000,0.3333},
	{1.0000,1.0000,0.0000},
	{0.6667,1.0000,0.0000},
	{0.3333,1.0000,0.0000},
	{0.0000,1.0000,0.0000},
	{1.0000,0.8333,0.0000},
	{0.6667,0.8333,0.0000},
	{0.3333,0.8333,0.0000},
	{0.0000,0.8333,0.0000},
	{1.0000,0.6667,0.0000},
	{0.6667,0.6667,0.0000},
	{0.3333,0.6667,0.0000},
	{0.0000,0.6667,0.0000},
	{1.0000,0.5000,0.0000},
	{0.6667,0.5000,0.0000},
	{0.3333,0.5000,0.0000},
	{0.0000,0.5000,0.0000},
	{1.0000,0.3333,0.0000},
	{0.6667,0.3333,0.0000},
	{0.3333,0.3333,0.0000},
	{0.0000,0.3333,0.0000},
	{1.0000,0.1667,0.0000},
	{0.6667,0.1667,0.0000},
	{0.3333,0.1667,0.0000},
	{0.0000,0.1667,0.0000},
	{1.0000,0.0000,0.0000},
	{0.6667,0.0000,0.0000},
	{0.3333,0.0000,0.0000},
	{0.0,0.0,0.0},
	{0.05,0.05,0.05},
	{0.10,0.10,0.10},
	{0.15,0.15,0.15},
	{0.20,0.20,0.20},
	{0.25,0.25,0.25},
	{0.30,0.30,0.30},
	{0.35,0.35,0.35},
	{0.40,0.40,0.40},
	{0.45,0.45,0.45},
	{0.50,0.50,0.50},
	{0.55,0.55,0.55},
	{0.60,0.60,0.60},
	{0.65,0.65,0.65},
	{0.70,0.70,0.70},
	{0.75,0.75,0.75},
	{0.80,0.80,0.80},
	{0.85,0.85,0.85},
	{0.90,0.90,0.90},
	{0.95,0.95,0.95}
};

static NhlColor	cyclic[] = {
	{-1.0,0.0,0.0},	/* white/black */
	{-1.0,0.0,0.0},	/* white/black */
	{1.0,0.0,0.0},	/* red */
	{0.0,1.0,0.0},	/* green */
	{0.0,0.0,1.0},	/* blue */
	{1.0,1.0,0.0},	/* yellow */
	{0.0,1.0,1.0},	/* cyan */
	{1.0,0.0,1.0}	/* magenta */
};

static NhlColor	gscyclic[] = {
	{-1.0,0.0,0.0},	/* white/black */
	{-1.0,0.0,0.0},	/* white/black */
	{0.5,0.5,0.5},
	{0.125,0.125,0.125},
	{0.75,0.75,0.75},
	{0.25,0.25,0.25},
	{0.625,0.625,0.625},
	{0.375,0.375,0.375},
};

static NhlColor gsld[] = {
	{0.00000,0.00000,0.00000},
	{1.00000,1.00000,1.00000},
	{0.96875,0.96875,0.96875},
	{0.93750,0.93750,0.93750},
	{0.90625,0.90625,0.90625},
	{0.87500,0.87500,0.87500},
	{0.84375,0.84375,0.84375},
	{0.81250,0.81250,0.81250},
	{0.78125,0.78125,0.78125},
	{0.75000,0.75000,0.75000},
	{0.71875,0.71875,0.71875},
	{0.68750,0.68750,0.68750},
	{0.65625,0.65625,0.65625},
	{0.62500,0.62500,0.62500},
	{0.59375,0.59375,0.59375},
	{0.56250,0.56250,0.56250},
	{0.53125,0.53125,0.53125},
	{0.50000,0.50000,0.50000},
	{0.46875,0.46875,0.46875},
	{0.43750,0.43750,0.43750},
	{0.40625,0.40625,0.40625},
	{0.37500,0.37500,0.37500},
	{0.34375,0.34375,0.34375},
	{0.31250,0.31250,0.31250},
	{0.28125,0.28125,0.28125},
	{0.25000,0.25000,0.25000},
	{0.21875,0.21875,0.21875},
	{0.18750,0.18750,0.18750},
	{0.15625,0.15625,0.15625},
	{0.12500,0.12500,0.12500},
	{0.09375,0.09375,0.09375},
	{0.06250,0.06250,0.06250},
	{0.03125,0.03125,0.03125},
};

static NhlColor gsdl[] = {
	{1.00000,1.00000,1.00000},
	{0.00000,0.00000,0.00000},
	{0.03125,0.03125,0.03125},
	{0.06250,0.06250,0.06250},
	{0.09375,0.09375,0.09375},
	{0.12500,0.12500,0.12500},
	{0.15625,0.15625,0.15625},
	{0.18750,0.18750,0.18750},
	{0.21875,0.21875,0.21875},
	{0.25000,0.25000,0.25000},
	{0.28125,0.28125,0.28125},
	{0.31250,0.31250,0.31250},
	{0.34375,0.34375,0.34375},
	{0.37500,0.37500,0.37500},
	{0.40625,0.40625,0.40625},
	{0.43750,0.43750,0.43750},
	{0.46875,0.46875,0.46875},
	{0.50000,0.50000,0.50000},
	{0.53125,0.53125,0.53125},
	{0.56250,0.56250,0.56250},
	{0.59375,0.59375,0.59375},
	{0.62500,0.62500,0.62500},
	{0.65625,0.65625,0.65625},
	{0.68750,0.68750,0.68750},
	{0.71875,0.71875,0.71875},
	{0.75000,0.75000,0.75000},
	{0.78125,0.78125,0.78125},
	{0.81250,0.81250,0.81250},
	{0.84375,0.84375,0.84375},
	{0.87500,0.87500,0.87500},
	{0.90625,0.90625,0.90625},
	{0.93750,0.93750,0.93750},
	{0.96875,0.96875,0.96875},
};

static NhlColor uniform[112] = {
	{-1.0,0.0,0.0},	/* white/black */
	{-1.0,0.0,0.0},	/* white/black */
	{0.6667,1.0000,1.0000},
	{0.3333,1.0000,1.0000},
	{0.0000,1.0000,1.0000},
	{1.0000,0.8333,1.0000},
	{0.6667,0.8333,1.0000},
	{0.3333,0.8333,1.0000},
	{0.0000,0.8333,1.0000},
	{1.0000,0.6667,1.0000},
	{0.6667,0.6667,1.0000},
	{0.3333,0.6667,1.0000},
	{0.0000,0.6667,1.0000},
	{1.0000,0.5000,1.0000},
	{0.6667,0.5000,1.0000},
	{0.3333,0.5000,1.0000},
	{0.0000,0.5000,1.0000},
	{1.0000,0.3333,1.0000},
	{0.6667,0.3333,1.0000},
	{0.3333,0.3333,1.0000},
	{0.0000,0.3333,1.0000},
	{1.0000,0.1667,1.0000},
	{0.6667,0.1667,1.0000},
	{0.3333,0.1667,1.0000},
	{0.0000,0.1667,1.0000},
	{1.0000,0.0000,1.0000},
	{0.6667,0.0000,1.0000},
	{0.3333,0.0000,1.0000},
	{0.0000,0.0000,1.0000},
	{1.0000,1.0000,0.6667},
	{0.6667,1.0000,0.6667},
	{0.3333,1.0000,0.6667},
	{0.0000,1.0000,0.6667},
	{1.0000,0.8333,0.6667},
	{0.6667,0.8333,0.6667},
	{0.3333,0.8333,0.6667},
	{0.0000,0.8333,0.6667},
	{1.0000,0.6667,0.6667},
	{0.6667,0.6667,0.6667},
	{0.3333,0.6667,0.6667},
	{0.0000,0.6667,0.6667},
	{1.0000,0.5000,0.6667},
	{0.6667,0.5000,0.6667},
	{0.3333,0.5000,0.6667},
	{0.0000,0.5000,0.6667},
	{1.0000,0.3333,0.6667},
	{0.6667,0.3333,0.6667},
	{0.3333,0.3333,0.6667},
	{0.0000,0.3333,0.6667},
	{1.0000,0.1667,0.6667},
	{0.6667,0.1667,0.6667},
	{0.3333,0.1667,0.6667},
	{0.0000,0.1667,0.6667},
	{1.0000,0.0000,0.6667},
	{0.6667,0.0000,0.6667},
	{0.3333,0.0000,0.6667},
	{0.0000,0.0000,0.6667},
	{1.0000,1.0000,0.3333},
	{0.6667,1.0000,0.3333},
	{0.3333,1.0000,0.3333},
	{0.0000,1.0000,0.3333},
	{1.0000,0.8333,0.3333},
	{0.6667,0.8333,0.3333},
	{0.3333,0.8333,0.3333},
	{0.0000,0.8333,0.3333},
	{1.0000,0.6667,0.3333},
	{0.6667,0.6667,0.3333},
	{0.3333,0.6667,0.3333},
	{0.0000,0.6667,0.3333},
	{1.0000,0.5000,0.3333},
	{0.6667,0.5000,0.3333},
	{0.3333,0.5000,0.3333},
	{0.0000,0.5000,0.3333},
	{1.0000,0.3333,0.3333},
	{0.6667,0.3333,0.3333},
	{0.3333,0.3333,0.3333},
	{0.0000,0.3333,0.3333},
	{1.0000,0.1667,0.3333},
	{0.6667,0.1667,0.3333},
	{0.3333,0.1667,0.3333},
	{0.0000,0.1667,0.3333},
	{1.0000,0.0000,0.3333},
	{0.6667,0.0000,0.3333},
	{0.3333,0.0000,0.3333},
	{0.0000,0.0000,0.3333},
	{1.0000,1.0000,0.0000},
	{0.6667,1.0000,0.0000},
	{0.3333,1.0000,0.0000},
	{0.0000,1.0000,0.0000},
	{1.0000,0.8333,0.0000},
	{0.6667,0.8333,0.0000},
	{0.3333,0.8333,0.0000},
	{0.0000,0.8333,0.0000},
	{1.0000,0.6667,0.0000},
	{0.6667,0.6667,0.0000},
	{0.3333,0.6667,0.0000},
	{0.0000,0.6667,0.0000},
	{1.0000,0.5000,0.0000},
	{0.6667,0.5000,0.0000},
	{0.3333,0.5000,0.0000},
	{0.0000,0.5000,0.0000},
	{1.0000,0.3333,0.0000},
	{0.6667,0.3333,0.0000},
	{0.3333,0.3333,0.0000},
	{0.0000,0.3333,0.0000},
	{1.0000,0.1667,0.0000},
	{0.6667,0.1667,0.0000},
	{0.3333,0.1667,0.0000},
	{0.0000,0.1667,0.0000},
	{1.0000,0.0000,0.0000},
	{0.6667,0.0000,0.0000},
	{0.3333,0.0000,0.0000}
};

typedef struct _CmapDefs{
	char		*name;
	NhlColor	*cmap;
	int		cmap_size;
	NhlGenArray	gen;
} CmapDefs;

/*
 * List of all pre-defined colormaps.  Eventually, I would like to add
 * a dynamic list, so the user can add thier own cmap's.
 */
static CmapDefs cmaps[] = {
	{"default",	def,		NhlNumber(def),		NULL},
	{"cyclic",	cyclic,		NhlNumber(cyclic),	NULL},
	{"gscyclic",	gscyclic,	NhlNumber(gscyclic),	NULL},
	{"gsltod",	gsld,		NhlNumber(gsld),	NULL},
	{"gsdtol",	gsdl,		NhlNumber(gsdl),	NULL},
	{"uniform",	uniform,	NhlNumber(uniform),	NULL}
};

static NrmQuark	strgenQ = NrmNULLQUARK;
static NrmQuark	fltgenQ = NrmNULLQUARK;
static NrmQuark	scalarQ = NrmNULLQUARK;

/*
 * Function:	NhlCvtStringToCmap
 *
 * Description:	
 *
 * In Args:	
 *
 * Out Args:	
 *
 * Scope:	
 * Returns:	
 * Side Effect:	
 */
static NhlErrorTypes
NhlCvtStringToCmap
#if	NhlNeedProto
(
	NrmValue		*from,
	NrmValue		*to,
	NhlConvertArgList	args,
	int			nargs
)
#else
(from,to,args,nargs)
	NrmValue		*from;
	NrmValue		*to;
	NhlConvertArgList	args;
	int			nargs;
#endif
{
	char		func[]="NhlCvtStringToCmap";
	NhlString	s1 = from->data.strval;
	NhlGenArray	gen;
	NrmValue	val;
	int		i;
	NhlErrorTypes	ret = NhlNOERROR;

	gen = _NhlStringToStringGenArray(s1);
	if(gen){
		val.size = sizeof(NhlGenArray);
		val.data.ptrval = gen;

		return _NhlReConvertData(strgenQ,to->typeQ,&val,to);
	}

	for(i=0;i < NhlNumber(cmaps);i++){
		if(_NhlCmpString(cmaps[i].name,s1) == 0){
			gen = cmaps[i].gen;
			break;
		}
	}

	if(!gen){
		NhlPError(NhlWARNING,NhlEUNKNOWN,
			"%s:Unable to convert string \"%s\" to %s",func,s1,
			NhlTColorMap);
		return NhlFATAL;
	}

	_NhlSetVal(NhlGenArray,sizeof(NhlGenArray),gen);
}

/*
 * Function:	NhlCvtGenArrayToCmap
 *
 * Description:	
 *
 * In Args:	
 *
 * Out Args:	
 *
 * Scope:	
 * Returns:	
 * Side Effect:	
 */
static NhlErrorTypes
NhlCvtGenArrayToCmap
#if	NhlNeedProto
(
	NrmValue		*from,
	NrmValue		*to,
	NhlConvertArgList	args,
	int			nargs
)
#else
(from,to,args,nargs)
	NrmValue		*from;
	NrmValue		*to;
	NhlConvertArgList	args;
	int			nargs;
#endif
{
	char		func[]="NhlCvtGenArrayToCmap";
	NhlGenArray	gen = from->data.ptrval;
	NhlErrorTypes	ret = NhlNOERROR;

	if(!gen){
		_NhlSetVal(NhlGenArray,sizeof(NhlGenArray),gen);
	}

	if((gen->num_dimensions != 2) || (gen->len_dimensions[1] != 3)){
		if((gen->num_elements == 1) &&
			(gen->size <= sizeof(NhlArgVal)) && (gen->size > 0)){
			NrmValue	val;

			memcpy((char*)&val.data,(char*)gen->data,gen->size);
			val.size = gen->size;

			return _NhlReConvertData(gen->typeQ,to->typeQ,&val,to);
		}
		NhlPError(NhlFATAL,NhlEUNKNOWN,
			"%s:From array has wrong dimentionality",func);
		return NhlFATAL;
	}

	if(gen->typeQ == fltgenQ){
		_NhlSetVal(NhlGenArray,sizeof(NhlGenArray),gen);
	}

	return _NhlReConvertData(from->typeQ,fltgenQ,from,to);
}

/*
 * Function:	_NhlInitPallets
 *
 * Description:	
 *
 * In Args:	
 *
 * Out Args:	
 *
 * Scope:	
 * Returns:	
 * Side Effect:	
 */
NhlErrorTypes
_NhlInitPallets
#if	NhlNeedProto
(
	void
)
#else
()
#endif
{
	char	func[]="_NhlInitPallets";
	int	dimlen[2] = {0,3};
	int	i;

	/*
	 * Initialize GenArray's for each of the colormaps
	 */
	for(i=0; i < NhlNumber(cmaps);i++){
		dimlen[0] = cmaps[i].cmap_size;
		cmaps[i].gen = _NhlCreateGenArray(cmaps[i].cmap,
					NhlTFloat,sizeof(float),2,dimlen,False);
		if(!cmaps[i].gen){
			NHLPERROR((NhlWARNING,ENOMEM,
				"%s:Unable to initialze color pallets",func));
			return NhlWARNING;
		}
	}

	(void)_NhlRegisterTypes(NhlTFloatGenArray,NhlTColorMap,NULL);

	(void)_NhlRegSymConv(NhlTQuarkGenArray,NhlTColorMap,
						NhlTQuarkGenArray,NhlTGenArray);
	(void)NhlRegisterConverter(NhlTString,NhlTColorMap,
					NhlCvtStringToCmap,NULL,0,False,NULL);
	(void)_NhlRegSymConv(NhlTQuark,NhlTColorMap,NhlTQuark,NhlTScalar);
	(void)NhlRegisterConverter(NhlTGenArray,NhlTColorMap,
					NhlCvtGenArrayToCmap,NULL,0,False,NULL);

	strgenQ = NrmStringToQuark(NhlTStringGenArray);
	fltgenQ = NrmStringToQuark(NhlTFloatGenArray);
	scalarQ = NrmStringToQuark(NhlTScalar);

	return NhlNOERROR;
}
